# Telegram Channel Scraper

Этот проект предназначен для сбора информации из Telegram-каналов и сохранения результатов в CSV-файл с возможностью возобновления работы и переключения между несколькими аккаунтами.

## 1. Установка необходимых библиотек

```bash
pip install -r requirements.txt
```

или вручную:

```bash
pip install telethon python-dotenv
```

## 2. Получение API-доступа к Telegram

Для работы скрипта вам необходимо получить `api_id` и `api_hash`:

1. Перейдите на сайт [my.telegram.org](https://my.telegram.org/)
2. Авторизуйтесь с помощью своего номера телефона
3. Выберите "API development tools"
4. Заполните форму (название приложения и короткое описание)
5. Вам будет предоставлен `api_id` (число) и `api_hash` (строка)

## 3. Настройка скрипта

Создайте файл `.env` в корневой директории проекта и добавьте в него свои API-учетные данные:

```
TELEGRAM_API_ID=ваш_api_id
TELEGRAM_API_HASH=ваш_api_hash
```

Вы можете скопировать файл `.env.example` и переименовать его в `.env`, затем отредактировать, заменив примеры значений своими актуальными данными.

## 4. Создание сессий Telegram

Перед запуском основного скрипта вам необходимо создать одну или несколько сессий Telegram:

1. Запустите скрипт создания сессий: `python create_sessions.py`
2. Выберите опцию "1" для создания новых сессий
3. Введите желаемое количество сессий
4. Для каждой сессии укажите номер телефона и код подтверждения

Вы можете проверить созданные сессии, выбрав опцию "2" в меню скрипта.

## 5. Запуск скрипта парсера

1. Убедитесь, что файл `Results.txt` находится в папке `Results`
2. Убедитесь, что у вас есть хотя бы одна активная сессия (создана с помощью `create_sessions.py`)
3. Запустите скрипт: `python TG_parser.py`
4. Скрипт автоматически выберет доступную сессию и начнет сбор данных
5. Результаты сохраняются в файл `Results/Table.csv`

Особенности работы:
- Скрипт сохраняет прогресс после обработки каждого канала, что позволяет возобновить работу с того места, где она была прервана
- При превышении лимита запросов (FloodWaitError) с временем ожидания более 5 минут, скрипт автоматически переключится на другую сессию, если она доступна

## 6. Структура проекта

```
project/
│
├── Html/                   # Папка с HTML-файлами для парсинга
│
├── Results/                # Папка с результатами
│   ├── Results.txt         # Список юзернеймов каналов для анализа
│   ├── Table.csv           # Выходной CSV-файл с собранными данными
│   ├── progress.json       # Файл для сохранения прогресса
│   ├── AI.txt              # Категоризированные списки юзернеймов
│   ├── Data Science.txt    # Категоризированные списки юзернеймов
│   └── ИИ.txt              # Категоризированные списки юзернеймов
│
├── sessions/               # Папка с сессиями Telegram
│   ├── sessions_info.json  # Информация о созданных сессиях
│   ├── session_1.session   # Файлы сессий Telegram
│   └── ...                 # Дополнительные файлы сессий
│
├── TG_parser.py            # Основной скрипт для анализа Telegram-каналов
├── create_sessions.py      # Скрипт для создания сессий Telegram
├── html_parser.py          # Скрипт для извлечения юзернеймов из HTML-файлов
├── .env                    # Файл с API-учетными данными
├── .env.example            # Пример файла с API-учетными данными
├── README.md               # Документация проекта
└── requirements.txt        # Список зависимостей
```

## 7. Особенности работы скрипта

1. Скрипт обрабатывает все юзернеймы из файла `Results.txt` последовательно
2. Для каждого канала собирается:
   - Дата последнего поста
   - Количество постов за последние 7 дней
   - Юзернейм из описания канала (если есть)
3. Между запросами добавлена задержка 1 секунда для избежания ограничений API
4. Обрабатываются следующие ошибки:
   - Приватный канал
   - Несуществующий канал
   - Превышение лимитов API (в этом случае скрипт ждет указанное время или переключается на другую сессию)
5. Возобновление работы:
   - Скрипт сохраняет информацию о текущем прогрессе в файл `Results/progress.json`
   - При повторном запуске скрипт проверяет файл прогресса и продолжает с последнего обработанного канала
6. Переключение сессий:
   - Если время ожидания после FloodWaitError превышает 5 минут, скрипт пытается переключиться на другую сессию
   - Сессии, которые достигли лимита, помечаются как находящиеся на охлаждении (cooldown) на 30 минут

## 8. Технические требования

- Python 3.7 или выше
- Telethon 1.26.0 или выше
- python-dotenv 1.0.0 или выше
- Доступ к интернету и сервисам Telegram